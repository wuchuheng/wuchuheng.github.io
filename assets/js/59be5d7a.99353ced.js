(self.webpackChunknotebook=self.webpackChunknotebook||[]).push([[3483],{67042:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var i,s=n(18482),o=n(22374),r=n(68196),c=n.n(r),a=n(13430),u="mainWrapper_wpRl",l=function(e){var t=e.style,n=(0,a.css)(i||(i=(0,s.Z)(["\n        display: block;\n        margin: 0 auto;\n    "])));return o.createElement("div",{className:u,style:Object.assign({},t)},o.createElement(c(),{css:n,color:"var(--ifm-color-primary)"}))}},55173:function(e,t,n){"use strict";n.r(t);var i,s=n(18482),o=n(22374),r=n(58053),c=n(41069),a=n(79229),u=n(76324);t.default=function(){var e=(0,o.useState)(""),t=e[0],n=e[1],l=function(){};if(c.Z.canUseDOM){var h=(0,a.Ps)(i||(i=(0,s.Z)(["\n            mutation CREATE_TODO($input: InputCreateTodoInput!){\n                createTodo(input: $input) {\n                    id\n                    title\n                    done\n                    createdAt\n                    doneAt\n\n                }\n            }\n        "]))),d=(0,u.D)(h,{variables:{input:{title:t}}}),p=d[0],f=d[1],m=(f.data,f.loading);f.error;l=p,(0,o.useEffect)((function(){return!m&&n("")}),[m])}return o.createElement("input",{value:t,type:"text",onChange:function(e){return n(e.target.value)},className:r.Z.searchInput,onKeyDown:function(e){"Enter"===e.key&&t.trim().length>0&&(console.log("commit"),l())},placeholder:"Please enter a new todo."})}},89466:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var i,s,o=n(18482),r=n(22374),c="todoItem_vRGj",a="titleRender_e9ns",u="closeIcon_U_zB",l="editInput_U8Pl",h=n(79229),d=n(76324),p=n(41069),f=function(e,t){var n;return function(){n&&clearTimeout(n),n=setTimeout((function(){e()}),t)}},m=function(e){var t=e.todo,n=e.onChange,m=e.currentChangeId,v=(0,r.useState)(!1),y=v[0],b=v[1],g=(0,h.Ps)(i||(i=(0,o.Z)(["\n        mutation  UPDATE_TODO($input: InputUpdateTodoInput!){\n            updateTodo(input:$input) {\n                id\n                done\n                title\n            }\n        }\n    "]))),w=function(){};if(p.Z.canUseDOM){var T=(0,d.D)(g),k=T[0],E=T[1];E.data,E.loading,E.error;w=function(){k({variables:{input:{id:t.id,done:!0}}})}}var I,C=(0,r.useState)(Date.now()+1e3),M=C[0],x=C[1],O=(0,r.useState)(!1),_=O[0],R=O[1],A=(0,r.useState)(""),S=A[0],D=A[1];if((0,r.useEffect)((function(){return(null==t?void 0:t.title)&&D(null==t?void 0:t.title)}),[null==t?void 0:t.title]),(0,r.useEffect)((function(){return m!=t.id&&_&&R(!1)}),[m]),p.Z.canUseDOM){var L=(0,h.Ps)(s||(s=(0,o.Z)(["\n            mutation  UPDATE_TODO($input: InputUpdateTodoInput!){\n                updateTodo(input:$input) {\n                    id\n                    done\n                    title\n                }\n            }\n        "]))),N=(0,d.D)(L,{variables:{input:{id:null==t?void 0:t.id,title:S}}}),j=N[0],P=N[1].updateLoading;I=j,(0,r.useEffect)((function(){return!P&&console.log("Updated successful")}),[P]);var U=f((function(){return I()}),1e3);(0,r.useEffect)((function(){S!=(null==t?void 0:t.title)&&S&&U()}),[S])}return r.createElement("li",{key:null==t?void 0:t.id,className:c,onMouseEnter:function(){return b(!0)},onMouseLeave:function(){return b(!1)}},r.createElement("div",{className:a},null==t?void 0:t.id,"\u2003",!_&&r.createElement("span",{onClick:function(){Date.now()<500+M?(R(!0),b(!1),n&&n(t.id)):x(Date.now())}},null==t?void 0:t.title," "),_&&r.createElement("input",{autoFocus:!0,className:l,value:S,onChange:function(e){return D(e.target.value)}})),y&&r.createElement("div",{className:u,onClick:w},"X"))}},75141:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return _}});var i,s=n(22374),o=n(58053),r=n(90203),c=n(41069),a=n(18482),u=n(2091),l=n(72718),h="server.notes.wuchuheng.com",d=new u.f({uri:"https://"+h+"/graphql",cache:new l.h}),p=n(93402),f=n.n(p),m=n(80655),v=n.n(m),y=n(18173),b=1e3,g=3e4,w=e=>"string"==typeof e,T=function(){return new class{constructor(e,t){const{connectionCallback:n,connectionParams:i={},minTimeout:s=b,timeout:o=g,reconnect:r=!1,reconnectionAttempts:c=1/0,lazy:a=!1,inactivityTimeout:u=0}=t||{};this.wsImpl=WebSocket,this.connectionCallback=n,this.url=e,this.operations={},this.nextOperationId=0,this.wsMinTimeout=s,this.wsTimeout=o,this.unsentMessagesQueue=[],this.reconnect=r,this.reconnecting=!1,this.reconnectionAttempts=c,this.lazy=!!a,this.inactivityTimeout=u,this.closedByUser=!1,this.backoff=new(f())({jitter:.5}),this.eventEmitter=new(v()),this.client=null,this.maxConnectTimeGenerator=this.createMaxConnectTimeGenerator(),this.connectionParams=this.getConnectionParams(i),this.lazy||this.connect()}get status(){return null===this.client?this.wsImpl.CLOSED:this.client.readyState}close(e=!0,t=!0){this.clearInactivityTimeout(),null!==this.client&&(this.closedByUser=t,e&&(this.clearCheckConnectionInterval(),this.clearMaxConnectTimeout(),this.clearTryReconnectTimeout(),this.unsubscribeAll(),this.sendMessage(void 0,"connection_terminate",null)),this.client.close(),this.client=null,this.eventEmitter.emit("disconnected"),e||this.tryReconnect())}request(e){const t=this.getObserver.bind(this),n=this.executeOperation.bind(this),i=this.unsubscribe.bind(this);let s;return this.clearInactivityTimeout(),{[y.Z](){return this},subscribe(o,r,c){const a=t(o,r,c);return s=n(e,((e,t)=>{null===e&&null===t?a.complete&&a.complete():e?a.error&&a.error(e[0]):a.next&&a.next(t)})),{unsubscribe:()=>{s&&(i(s),s=null)}}}}}on(e,t,n){const i=this.eventEmitter.on(e,t,n);return()=>{i.off(e,t,n)}}onConnected(e,t){return this.on("connected",e,t)}onConnecting(e,t){return this.on("connecting",e,t)}onDisconnected(e,t){return this.on("disconnected",e,t)}onReconnected(e,t){return this.on("reconnected",e,t)}onReconnecting(e,t){return this.on("reconnecting",e,t)}onError(e,t){return this.on("error",e,t)}unsubscribeAll(){Object.keys(this.operations).forEach((e=>{this.unsubscribe(e)}))}getConnectionParams(e){return()=>new Promise(((t,n)=>{if("function"==typeof e)try{return t(e())}catch(i){return n(i)}t(e)}))}executeOperation(e,t){null===this.client&&this.connect();const n=this.generateOperationId();this.operations[n]={options:e,handler:t};try{this.checkOperationOptions(e,t),this.operations[n]&&(this.operations[n]={options:e,handler:t},this.sendMessage(n,"start",e))}catch(i){this.unsubscribe(n),t(this.formatErrors(i))}return n}getObserver(e,t,n){return"function"==typeof e?{next:t=>e(t),error:e=>t&&t(e),complete:()=>n&&n()}:e}createMaxConnectTimeGenerator(){const e=this.wsMinTimeout,t=this.wsTimeout;return new(f())({min:e,max:t,factor:1.2})}clearCheckConnectionInterval(){this.checkConnectionIntervalId&&(clearInterval(this.checkConnectionIntervalId),this.checkConnectionIntervalId=null)}clearMaxConnectTimeout(){this.maxConnectTimeoutId&&(clearTimeout(this.maxConnectTimeoutId),this.maxConnectTimeoutId=null)}clearTryReconnectTimeout(){this.tryReconnectTimeoutId&&(clearTimeout(this.tryReconnectTimeoutId),this.tryReconnectTimeoutId=null)}clearInactivityTimeout(){this.inactivityTimeoutId&&(clearTimeout(this.inactivityTimeoutId),this.inactivityTimeoutId=null)}setInactivityTimeout(){this.inactivityTimeout>0&&0===Object.keys(this.operations).length&&(this.inactivityTimeoutId=setTimeout((()=>{0===Object.keys(this.operations).length&&this.close()}),this.inactivityTimeout))}checkOperationOptions(e,t){const{query:n,variables:i,operationName:s}=e;if(!n)throw new Error("Must provide a query.");if(!t)throw new Error("Must provide an handler.");if(!w(n)||s&&!w(s)||i&&(null===(o=i)||"object"!=typeof o))throw new Error("Incorrect option types. query must be a string,`operationName` must be a string, and `variables` must be an object.");var o}buildMessage(e,t,n){return{id:e,type:t,payload:n&&n.query?Object.assign({},n,{query:n.query}):n}}formatErrors(e){return Array.isArray(e)?e:e&&e.errors?this.formatErrors(e.errors):e&&e.message?[e]:[{name:"FormatedError",message:"Unknown error",originalError:e}]}sendMessage(e,t,n){this.sendMessageRaw(this.buildMessage(e,t,n))}sendMessageRaw(e){switch(this.status){case this.wsImpl.OPEN:const n=JSON.stringify(e);try{JSON.parse(n)}catch(t){this.eventEmitter.emit("error",new Error(`Message must be JSON-serializable. Got: ${e}`))}this.client.send(n);break;case this.wsImpl.CONNECTING:this.unsentMessagesQueue.push(e);break;default:this.reconnecting||this.eventEmitter.emit("error",new Error("A message was not sent because socket is not connected, is closing or is already closed. Message was: "+JSON.stringify(e)))}}generateOperationId(){return String(++this.nextOperationId)}tryReconnect(){if(!this.reconnect||this.backoff.attempts>=this.reconnectionAttempts)return;this.reconnecting||(Object.keys(this.operations).forEach((e=>{this.unsentMessagesQueue.push(this.buildMessage(e,"start",this.operations[e].options))})),this.reconnecting=!0),this.clearTryReconnectTimeout();const e=this.backoff.duration();this.tryReconnectTimeoutId=setTimeout((()=>{this.connect()}),e)}flushUnsentMessagesQueue(){this.unsentMessagesQueue.forEach((e=>{this.sendMessageRaw(e)})),this.unsentMessagesQueue=[]}checkConnection(){this.wasKeepAliveReceived?this.wasKeepAliveReceived=!1:this.reconnecting||this.close(!1,!0)}checkMaxConnectTimeout(){this.clearMaxConnectTimeout(),this.maxConnectTimeoutId=setTimeout((()=>{this.status!==this.wsImpl.OPEN&&(this.reconnecting=!0,this.close(!1,!0))}),this.maxConnectTimeGenerator.duration())}connect(){this.client=new WebSocket(this.url,"graphql-ws"),this.checkMaxConnectTimeout(),this.client.addEventListener("open",(async()=>{if(this.status===this.wsImpl.OPEN){this.clearMaxConnectTimeout(),this.closedByUser=!1,this.eventEmitter.emit(this.reconnecting?"reconnecting":"connecting");try{const e=await this.connectionParams();this.sendMessage(void 0,"connection_init",e),this.flushUnsentMessagesQueue()}catch(e){this.sendMessage(void 0,"connection_error",e),this.flushUnsentMessagesQueue()}}})),this.client.onclose=()=>{this.closedByUser||this.close(!1,!1)},this.client.addEventListener("error",(e=>{this.eventEmitter.emit("error",e)})),this.client.addEventListener("message",(({data:e})=>{let t;try{t=JSON.parse(e)}catch(n){throw new Error(`Message must be JSON-parseable. Got: ${e}`)}if(Array.isArray(t))for(const i of t)this.processReceivedMessage(i);else this.processReceivedMessage(t)}))}processReceivedMessage(e){const t=e.id;if(!["data","complete","error"].includes(e.type)||this.operations[t])switch(e.type){case"connection_error":this.connectionCallback&&this.connectionCallback(e.payload);break;case"connection_ack":this.eventEmitter.emit(this.reconnecting?"reconnected":"connected"),this.reconnecting=!1,this.backoff.reset(),this.maxConnectTimeGenerator.reset(),this.connectionCallback&&this.connectionCallback();break;case"complete":this.operations[t].handler(null,null),delete this.operations[t];break;case"error":this.operations[t].handler(this.formatErrors(e.payload),null),delete this.operations[t];break;case"data":const n=e.payload.errors?{...e.payload,errors:this.formatErrors(e.payload.errors)}:e.payload;this.operations[t].handler(null,n);break;case"ka":const i=void 0===this.wasKeepAliveReceived;this.wasKeepAliveReceived=!0,i&&this.checkConnection(),this.checkConnectionIntervalId&&(clearInterval(this.checkConnectionIntervalId),this.checkConnection()),this.checkConnectionIntervalId=setInterval(this.checkConnection.bind(this),this.wsTimeout);break;default:throw new Error("Invalid message type!")}else this.unsubscribe(t)}unsubscribe(e){this.operations[e]&&(delete this.operations[e],this.setInactivityTimeout(),this.sendMessage(e,"stop",void 0))}}("wss://server.notes.wuchuheng.com/subscriptions",{reconnect:!0,lazy:!0,connectionCallback:function(e){e&&console.error(e)}})},k=n(79229),E=function(){function e(){!1===e.isSubscription&&this.connectSubscription()}var t=e.prototype;return t.getTodos=function(){return!1===e.isInisializeTodo&&this.initializeTodos(),e.todos},t.subscription=function(t){var n=e.callbackListLastId+1;return e.callbackList.set(n,t),e.callbackListLastId=n,e.callbackListLastId},t.unsubscription=function(t){return e.callbackList.delete(t)},t.initializeTodos=function(){var t=this,n=(0,k.Ps)(i||(i=(0,a.Z)(["\n            query {\n                todos {\n                    id\n                    title\n                    done\n                    createdAt\n                    doneAt\n                }\n            }\n        "])));d.query({query:n}).then((function(n){var i=n.data;e.todos=i.todos,t.pushDataByCallback(),e.isInisializeTodo=!0}))},t.pushDataByCallback=function(){e.callbackList.forEach((function(t){return t(e.todos)}))},t.connectSubscription=function(){var t=this;e.isSubscription||(e.isSubscription=!0,T().request({query:"\n        subscription {\n          todos{\n            id\n            title\n            done\n            doneAt\n            createdAt\n          }\n        }\n    "}).subscribe({next:function(n){var i=n.data;i&&(e.todos=i.todos,t.pushDataByCallback())}}))},e}();E.todos=[],E.isSubscription=!1,E.callbackList=new Map,E.callbackListLastId=0,E.isInisializeTodo=!1;var I=n(89466),C=n(55173),M=n(38333),x=n(67042),O=function(){var e=(0,s.useState)(0),t=e[0],n=e[1],i=(0,s.useState)([]),r=i[0],a=i[1];return c.Z.canUseDOM&&(0,s.useEffect)((function(){var e=new E,t=e.subscription((function(e){return a(e)}));return a(e.getTodos()),function(){e.unsubscription(t)}}),[]),s.createElement(s.Fragment,null,s.createElement("div",{className:o.Z.mainWrapper},s.createElement("div",{className:o.Z.container},s.createElement("h2",null,"todos"),s.createElement(C.default,null),s.createElement("ul",null,0===r.length&&s.createElement(x.Z,{style:{height:"100%",width:"100%"}}),r.length>0&&r.map((function(e){return s.createElement(I.default,{todo:e,key:e.id,currentChangeId:t,onChange:function(e){return n(e)}})}))))))},_=function(){var e=!0;return c.Z.canUseDOM&&(e=!("layout=false"===document.location.search.substr(1))),s.createElement(s.Fragment,null,e&&s.createElement(M.Z,null,s.createElement(r.e,{client:d},s.createElement(O,null))),!e&&s.createElement(r.e,{client:d},s.createElement(O,null)))}},93402:function(e){function t(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=t,t.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},t.prototype.reset=function(){this.attempts=0},t.prototype.setMin=function(e){this.ms=e},t.prototype.setMax=function(e){this.max=e},t.prototype.setJitter=function(e){this.jitter=e}},80655:function(e){"use strict";var t=Object.prototype.hasOwnProperty,n="~";function i(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,i,o,r){if("function"!=typeof i)throw new TypeError("The listener must be a function");var c=new s(i,o||e,r),a=n?n+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],c]:e._events[a].push(c):(e._events[a]=c,e._eventsCount++),e}function r(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function c(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),c.prototype.eventNames=function(){var e,i,s=[];if(0===this._eventsCount)return s;for(i in e=this._events)t.call(e,i)&&s.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},c.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,o=i.length,r=new Array(o);s<o;s++)r[s]=i[s].fn;return r},c.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},c.prototype.emit=function(e,t,i,s,o,r){var c=n?n+e:e;if(!this._events[c])return!1;var a,u,l=this._events[c],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,s),!0;case 5:return l.fn.call(l.context,t,i,s,o),!0;case 6:return l.fn.call(l.context,t,i,s,o,r),!0}for(u=1,a=new Array(h-1);u<h;u++)a[u-1]=arguments[u];l.fn.apply(l.context,a)}else{var d,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,i);break;case 4:l[u].fn.call(l[u].context,t,i,s);break;default:if(!a)for(d=1,a=new Array(h-1);d<h;d++)a[d-1]=arguments[d];l[u].fn.apply(l[u].context,a)}}return!0},c.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,i,s){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return r(this,o),this;var c=this._events[o];if(c.fn)c.fn!==t||s&&!c.once||i&&c.context!==i||r(this,o);else{for(var a=0,u=[],l=c.length;a<l;a++)(c[a].fn!==t||s&&!c[a].once||i&&c[a].context!==i)&&u.push(c[a]);u.length?this._events[o]=1===u.length?u[0]:u:r(this,o)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&r(this,t)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,e.exports=c},58053:function(e,t){"use strict";t.Z={mainWrapper:"mainWrapper_YYu3",container:"container_RvB5",searchInput:"searchInput_PoDq",todoItem:"todoItem_uzff",titleRender:"titleRender_hrCk",closeIcon:"closeIcon_zDeR"}},18173:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}}),e=n.hmd(e);var i=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:e)}}]);