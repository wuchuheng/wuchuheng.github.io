"use strict";(self.webpackChunknotebook=self.webpackChunknotebook||[]).push([[7758],{70224:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var r=n(22374);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=l(n),d=a,b=m["".concat(c,".").concat(d)]||m[d]||p[d]||o;return n?r.createElement(b,s(s({ref:t},u),{},{components:n})):r.createElement(b,s({ref:t},u))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=m;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var l=2;l<o;l++)s[l]=n[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},39166:function(e,t,n){var r=n(23405),a=n(54751),o=n(22374),s=n(67042),i=["src","style"];t.Z=function(e){var t=e.src,n=e.style,c=((0,a.Z)(e,i),(0,o.useState)(!0)),l=c[0],u=c[1],p=function(){return u(!1)},m={sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin",allow:"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking"},d=null!=t.match(/codesandbox\.io/),b=function(){return o.createElement(o.Fragment,null,o.createElement("iframe",(0,r.Z)({src:t,style:{width:"100%",height:"500px",border:"0",borderRadius:"4px",overflow:"hidden"},sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin",onLoad:p},d?m:{})),l&&o.createElement(s.Z,{style:Object.assign({},n)}))},f=function(){return o.createElement(o.Fragment,null,o.createElement("iframe",(0,r.Z)({src:t,style:Object.assign({width:"100%",height:"100%"},n,{display:l?"none":"block"}),onLoad:p},d?m:{})),l&&o.createElement(s.Z,{style:Object.assign({},n)}))};return o.createElement(o.Fragment,null,d&&o.createElement(b,null),!d&&o.createElement(f,null))}},67042:function(e,t,n){n.d(t,{Z:function(){return u}});var r,a=n(18482),o=n(22374),s=n(68196),i=n.n(s),c=n(13430),l="mainWrapper_wpRl",u=function(e){var t=e.style,n=(0,c.css)(r||(r=(0,a.Z)(["\n        display: block;\n        margin: 0 auto;\n    "])));return o.createElement("div",{className:l,style:Object.assign({},t)},o.createElement(i(),{css:n,color:"var(--ifm-color-primary)"}))}},25181:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return b},frontMatter:function(){return c},metadata:function(){return u},toc:function(){return m}});var r=n(23405),a=n(54751),o=(n(22374),n(70224)),s=n(39166),i=["components"],c={title:"04 \u81ea\u5df1\u5199\u4e2aredux",tags:["React","Hook","redux"],date:"2022-01-20 3:05"},l=void 0,u={unversionedId:"Web\u76f8\u5173/React/\u81ea\u5df1\u5199\u4e2aredux",id:"Web\u76f8\u5173/React/\u81ea\u5df1\u5199\u4e2aredux",title:"04 \u81ea\u5df1\u5199\u4e2aredux",description:"\u5728\u5199react\u662f\u9700\u8981\u7ec4\u4ef6\u548c\u7ec4\u4ef6\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u672c\u6765\u60f3\u7528redux\uff0c\u4f46\u81ea\u5df1\u5fd8\u4e86\u600e\u4e48\u7528\u4e86\uff0c\u7ffb\u6587\u6863\u53c8\u592a\u7d2f\uff0c\u611f\u89c9\u5f88\u9ebb\u70e6\uff0c\u6240\u4ee5\u5c31\u53ea\u80fd\u81ea\u5df1\u52a8\u624b\u5199\u4e00\u4e2a\uff0c\u624d\u80fd\u7ef4\u6301\u4e0b\u751f\u6d3b\u8fd9\u6837\u5b50\u3002",source:"@site/docs/08.Web\u76f8\u5173/06.React/04.\u81ea\u5df1\u5199\u4e2aredux.mdx",sourceDirName:"08.Web\u76f8\u5173/06.React",slug:"/Web\u76f8\u5173/React/\u81ea\u5df1\u5199\u4e2aredux",permalink:"/docs/Web\u76f8\u5173/React/\u81ea\u5df1\u5199\u4e2aredux",draft:!1,editUrl:"https://github.com/wuchuheng/wuchuheng.github.io/edit/master/docs/08.Web\u76f8\u5173/06.React/04.\u81ea\u5df1\u5199\u4e2aredux.mdx",tags:[{label:"React",permalink:"/docs/tags/react"},{label:"Hook",permalink:"/docs/tags/hook"},{label:"redux",permalink:"/docs/tags/redux"}],version:"current",sidebarPosition:4,frontMatter:{title:"04 \u81ea\u5df1\u5199\u4e2aredux",tags:["React","Hook","redux"],date:"2022-01-20 3:05"},sidebar:"tutorialSidebar",previous:{title:"03 React Hook\u7684\u5e94\u7528",permalink:"/docs/Web\u76f8\u5173/React/ReactHook\u7684\u5e94\u7528"},next:{title:"05 React\u4e8b\u4ef6\u7684\u6355\u83b7\u548c\u5192\u6ce1",permalink:"/docs/Web\u76f8\u5173/React/React\u4e8b\u4ef6\u7684\u6355\u83b7\u548c\u5192\u6ce1"}},p={},m=[{value:"2 \u4f7f\u7528\u524d\u9700\u8981\u58f0\u660e\u4e00\u4e2a\u516c\u5171\u7684\u7c7b\u4f5c\u4e3a\u7ec4\u4ef6\u548c\u7ec4\u4ef6\u4e4b\u95f4\u7684\u8c03\u5ea6\u5668",id:"2-\u4f7f\u7528\u524d\u9700\u8981\u58f0\u660e\u4e00\u4e2a\u516c\u5171\u7684\u7c7b\u4f5c\u4e3a\u7ec4\u4ef6\u548c\u7ec4\u4ef6\u4e4b\u95f4\u7684\u8c03\u5ea6\u5668",level:2},{value:"3\u7136\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u5404\u4e2a\u7ec4\u4ef6\u4e2d\u4f7f\u7528\u4e86",id:"3\u7136\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u5404\u4e2a\u7ec4\u4ef6\u4e2d\u4f7f\u7528\u4e86",level:2},{value:"\u6e90\u7801\u4ed3\u5e93",id:"\u6e90\u7801\u4ed3\u5e93",level:2}],d={toc:m};function b(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\u5728\u5199",(0,o.kt)("inlineCode",{parentName:"p"},"react"),"\u662f\u9700\u8981\u7ec4\u4ef6\u548c\u7ec4\u4ef6\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u672c\u6765\u60f3\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"redux"),"\uff0c\u4f46\u81ea\u5df1\u5fd8\u4e86\u600e\u4e48\u7528\u4e86\uff0c\u7ffb\u6587\u6863\u53c8\u592a\u7d2f\uff0c\u611f\u89c9\u5f88\u9ebb\u70e6\uff0c\u6240\u4ee5\u5c31\u53ea\u80fd\u81ea\u5df1\u52a8\u624b\u5199\u4e00\u4e2a\uff0c\u624d\u80fd\u7ef4\u6301\u4e0b\u751f\u6d3b\u8fd9\u6837\u5b50\u3002\n\u5176\u5b9e\u6838\u5fc3\u4e5f\u5c31\u4e0d\u523070\u884c\u4ee3\u7801\u8fd9\u4e2a\u6837\u5b50, \u5c31\u4e0b\u9762\u8fd9\u6837\u5b50\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"import { useEffect, useState } from 'react';\n\ntype SubscriptionHandler = number;\n\ninterface SubscriptionServiceInterface<T> {\n  value: T;\n\n  next(patchData: T): boolean;\n\n  subscription(patchDataCallback: (patchData: T) => void): SubscriptionHandler;\n\n  unSubscription(subscriptionHandler: SubscriptionHandler): boolean;\n\n  complete(): void;\n}\n\nexport default class SubscriptionService<T> implements SubscriptionServiceInterface<T> {\n  history: { time: Date; data: T }[] = [];\n  private subscriptions: Map<number, (patchData: T) => void> = new Map<number, (patchData: T) => void>();\n  value: T;\n\n  isComplete: boolean = false;\n\n  constructor(value: T) {\n    this.value = value;\n  }\n\n  next(patchData: T): boolean {\n    if (this.isComplete) {\n      return false;\n    }\n    this.history = [...this.history, { time: new Date(), data: this.value }];\n    this.value = patchData;\n    this.subscriptions.forEach((callback) => callback(this.value));\n\n    return true;\n  }\n\n  subscription(patchDataCallback: (patchData: T) => void): SubscriptionHandler {\n    const subscriptionHandler = this.subscriptions.size + 1;\n    this.subscriptions.set(subscriptionHandler, patchDataCallback);\n\n    return subscriptionHandler;\n  }\n\n  unSubscription(subscriptionHandler: SubscriptionHandler): boolean {\n    return !this.subscriptions.has(subscriptionHandler) ? false : this.subscriptions.delete(subscriptionHandler);\n  }\n\n  complete(): void {\n    this.isComplete = true;\n    this.subscriptions.clear();\n  }\n}\n\nexport const useObserve = <T>(observe: SubscriptionService<T>): [T, SubscriptionService<T>] => {\n  const [value, setValue] = useState<T>(observe.value);\n  useEffect(() => {\n    const subscriptionHandler = observe.subscription((newValue) => setValue(newValue));\n\n    return () => {\n      observe.unSubscription(subscriptionHandler);\n    };\n  }, []);\n\n  return [value, observe];\n};\n")),(0,o.kt)("p",null,"\u672c\u8d28\u5c31\u662f\u4e00\u4e2a\u4e8b\u4ef6\u8ba2\u9605\u548c\u4e8b\u4ef6\u53d1\u5e03\u3002"),(0,o.kt)("h2",{id:"2-\u4f7f\u7528\u524d\u9700\u8981\u58f0\u660e\u4e00\u4e2a\u516c\u5171\u7684\u7c7b\u4f5c\u4e3a\u7ec4\u4ef6\u548c\u7ec4\u4ef6\u4e4b\u95f4\u7684\u8c03\u5ea6\u5668"},"2 \u4f7f\u7528\u524d\u9700\u8981\u58f0\u660e\u4e00\u4e2a\u516c\u5171\u7684\u7c7b\u4f5c\u4e3a\u7ec4\u4ef6\u548c\u7ec4\u4ef6\u4e4b\u95f4\u7684\u8c03\u5ea6\u5668"),(0,o.kt)("p",null,"\u5176\u5b9e\u8fd9\u4e2a\u8c03\u5ea6\u5668\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u6709\u9759\u6001\u5c5e\u6027\u7684\u7c7b\uff0c\u4f5c\u7528\u5c31\u662f\u4fdd\u8bc1\u7ec4\u4ef6\u548c\u7ec4\u4ef6\u4e4b\u95f4\u4f7f\u7528\u7684\u662f\u4e00\u4e2a\u5185\u5b58\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u6709\u4e00\u4e2a\u7ec4\u4ef6\u53d1\u5e03\u4e8b\u4ef6\u4e86\uff0c\u53e6\u4e00\u4e2a\u4e5f\u662f\u4f7f\u7528\u8fd9\u4e00\u5185\u5b58\u4f5c\u4e3a\u4e8b\u4ef6\u7684\u8ba2\u9605\u7684\u7ec4\u4ef6\uff0c\u5c31\u80fd\u88ab\u56de\u8c03\u4e86\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u7ec4\u4ef6\u548c\u7ec4\u4ef6\u4e4b\u95f4\u7684\u901a\u4fe1\u3002\u8c03\u5ea6\u5668\u7684\u4ee3\u7801\u5c31\u8fd9\u6837\u4e86\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"import SubscriptionService from \"@wuchuheng/rxjs\";\n\nexport default class Scheduler {\n    // \u58f0\u660e\u4e00\u4e2a\u5171\u4eab\u4f1a\u8bdd\u7684\u804a\u5929\u5ba4\n    public static chatGroupObserve = new SubscriptionService<string>('');\n}\n")),(0,o.kt)("h2",{id:"3\u7136\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u5404\u4e2a\u7ec4\u4ef6\u4e2d\u4f7f\u7528\u4e86"},"3\u7136\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u5404\u4e2a\u7ec4\u4ef6\u4e2d\u4f7f\u7528\u4e86"),(0,o.kt)("p",null,"\u5982:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import React from \"react\";\nimport style from './style.module.scss';\nimport {useObserve} from \"@wuchuheng/rxjs\";\nimport Scheduler from \"./Scheduler\";\n\ntype BossPropsType = {name: string, quotes: string[]}\nconst bosses: BossPropsType[] = [\n    {name: '\u96f7\u4e0d\u6b7b', quotes: ['Hello!', 'Thank you very mach!', 'Are you ok!', '\u8fd9\u4ed6\u5988\u7684\u7edd\u5bf9\u662f\u6765\u6363\u4e71\u7684\uff01\uff01!']},\n    {name: '\u738b\u4e00\u4ebf', quotes: ['\u5b9a\u4e2a\u5c0f\u76ee\u6807', '\u8d5a\u5b83\u4e00\u4e2a\u4ebf']},\n    {name: '\u6770\u514b\u9a6c', quotes: ['996\u662f\u798f\u62a5', '\u5411\u793e\u4f1a\u8f93\u9001\u4eba\u624d']},\n    {name: '\u9ebb\u82b1\u75bc', quotes: ['\u5145\u94b1\u8ba9\u4f60\u66f4\u5f3a', '\u5357\u5c71\u5fc5\u80dc\u5ba2']},\n]\n\nconst formatTime = (time: Date): string => `${time.getHours()}:${time.getMinutes()}:${time.getSeconds()}`\n\nconst Boss = (props: BossPropsType): React.ReactElement => {\n    const [message, dispatcher] = useObserve(Scheduler.chatGroupObserve)\n    const handleChange = (e: string) => dispatcher.next(`${props.name}: ${e}`)\n\n    return (\n        <div className={style.bossWrapper}>\n            <div>\u5927\u4f6c: {props.name}</div>\n            <div>\n                <div>\u4ed6\u60f3\u8bf4:</div>\n                <select onChange={(e) => handleChange(e.target.value) }>\n                    {props.quotes.map(q => <option value={q} key={q}>{q}</option>)}\n                </select>\n                <div>\u6700\u65b0\u6d88\u606f: <span>{message}</span></div>\n            </div>\n            <div className={style.history}>\n                <div>\u5386\u53f2\u8bb0\u5f55:</div>\n                <div className={style.history}>\n                    {\n                        dispatcher.history.map(\n                            (m, k) =>\n                                <p key={k}>\n                                    {formatTime(m.time)} {m.data}\n                                </p>\n                        )\n                    }\n                </div>\n            </div>\n        </div>\n    )\n}\nconst CustomRedux = (): React.ReactElement => {\n    const BossesRender = (\n        bosses.map(\n            (bossInfo, k) => <Boss\n                name={bossInfo.name}\n                quotes={bossInfo.quotes} key={k}\n            />\n        )\n    )\n    return (\n        <div className={style.main}>\n            <h1>\u770b\u770b\u5927\u4f6c\u4eec\u90fd\u8bf4\u4e86\u4ec0\u4e48\uff1f</h1>\n            <div className={style.container}>\n                {BossesRender}\n            </div>\n        </div>\n    )\n}\n\nexport default CustomRedux\n\n")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f37a129bc13343b6981ad30c60d945ed~tplv-k3u1fbpfcp-zoom-1.image",alt:null})),(0,o.kt)(s.Z,{src:"https://codesandbox.io/embed/note-demo-for-react-7b6mf?fontsize=14&initialpath=%2FcustomRedux&theme=dark",mdxType:"IframeContainer"}),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://codesandbox.io/s/note-demo-for-react-7b6mf?fontsize=14&initialpath=%2FcustomRedux&theme=dark"},(0,o.kt)("img",{parentName:"a",src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d021098cec9845929ad3118080ff03a1~tplv-k3u1fbpfcp-zoom-1.image",alt:"Edit note-demo-for-react"}))),(0,o.kt)("h2",{id:"\u6e90\u7801\u4ed3\u5e93"},"\u6e90\u7801\u4ed3\u5e93"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u6838\u5fc3\u4ee3\u7801\u5df2\u7ecf\u6253\u5305\u6210\u4e3a",(0,o.kt)("inlineCode",{parentName:"p"},"npm"),"\u5e93\u4e86, ",(0,o.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@wuchuheng/rxjs"},"@wuchuheng/rxjs"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"npm i @wuchuheng/rxjs"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u4f7f\u7528\u7684\u793a\u4f8b\u7684github\u6e90\u7801\u5e93\u5728 ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wuchuhengnotes/note-demo-for-react"},"github")))))}b.isMDXComponent=!0}}]);