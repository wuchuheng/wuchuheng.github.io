"use strict";(self.webpackChunknotebook=self.webpackChunknotebook||[]).push([[4316],{34135:function(e,t,n){n.d(t,{Z:function(){return s}});var a=n(23405),i=n(22374),o=n(85986),l="layoutWrapper_U3sX";var s=function(e){var t=e.src,n=e.alt,s=e.align,p=e.size,r=t.match("https?://[^\\.]+\\.[^\\.]+"),c=(Object.assign({},n?{alt:n}:{}),i.createElement(o.Z,(0,a.Z)({url:r?t:"//qiniu.wuchuheng.com"+t,alt:n||""},null!=p?{width:p}:{width:30})));return"center"===s?i.createElement("div",{className:l},c):c}},85986:function(e,t,n){var a=n(22374),i=n(44171);t.Z=function(e){var t=e.alt,n=e.url,o=e.width,l=(0,a.useState)(!1),s=l[0],p=l[1];return a.createElement(a.Fragment,null,a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",justifyItems:"center"}},a.createElement("img",{src:n,onClick:function(){return p(!0)},alt:t,style:Object.assign({},null!=o?{width:o+"rem"}:{})}),s&&a.createElement(i.Z,{mainSrc:n,onCloseRequest:function(){return p(!1)}})))}},1052:function(e,t,n){n.r(t),n.d(t,{assets:function(){return f},contentTitle:function(){return r},default:function(){return m},frontMatter:function(){return p},metadata:function(){return c},toc:function(){return u}});var a=n(23405),i=n(54751),o=(n(22374),n(70224)),l=n(34135),s=["components"],p={title:"03 fastlane\u81ea\u52a8\u5316IOS\u5de5\u7a0b(\u4e09)-\u81ea\u52a8\u53d1\u5e03",date:"2023-01-06 08:52"},r=void 0,c={unversionedId:"NativeApp/19.2.IOSAPP/fastlane\u81ea\u52a8\u5316IOS\u5de5\u7a0b-\u81ea\u52a8\u53d1\u5e03",id:"NativeApp/19.2.IOSAPP/fastlane\u81ea\u52a8\u5316IOS\u5de5\u7a0b-\u81ea\u52a8\u53d1\u5e03",title:"03 fastlane\u81ea\u52a8\u5316IOS\u5de5\u7a0b(\u4e09)-\u81ea\u52a8\u53d1\u5e03",description:"1 \u4ec0\u4e48\u662f\u81ea\u52a8\u53d1\u5e03?",source:"@site/docs/19.NativeApp/19.2.IOSAPP/03.fastlane\u81ea\u52a8\u5316IOS\u5de5\u7a0b-\u81ea\u52a8\u53d1\u5e03.mdx",sourceDirName:"19.NativeApp/19.2.IOSAPP",slug:"/NativeApp/19.2.IOSAPP/fastlane\u81ea\u52a8\u5316IOS\u5de5\u7a0b-\u81ea\u52a8\u53d1\u5e03",permalink:"/docs/NativeApp/19.2.IOSAPP/fastlane\u81ea\u52a8\u5316IOS\u5de5\u7a0b-\u81ea\u52a8\u53d1\u5e03",draft:!1,editUrl:"https://github.com/wuchuheng/wuchuheng.github.io/edit/master/docs/19.NativeApp/19.2.IOSAPP/03.fastlane\u81ea\u52a8\u5316IOS\u5de5\u7a0b-\u81ea\u52a8\u53d1\u5e03.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"03 fastlane\u81ea\u52a8\u5316IOS\u5de5\u7a0b(\u4e09)-\u81ea\u52a8\u53d1\u5e03",date:"2023-01-06 08:52"},sidebar:"tutorialSidebar",previous:{title:"02 fastlane\u81ea\u52a8\u5316IOS\u5de5\u7a0b(\u4e8c)-\u8bc1\u4e66\u7684\u7ba1\u7406\u548c\u4f7f\u7528",permalink:"/docs/NativeApp/19.2.IOSAPP/fastlane\u81ea\u52a8\u5316IOS\u5de5\u7a0b-\u8bc1\u4e66\u7684\u7ba1\u7406\u548c\u4f7f\u7528"},next:{title:"04 fastlane\u81ea\u52a8\u5316IOS\u5de5\u7a0b(\u56db)-githubAction\u81ea\u52a8\u53d1\u5e03",permalink:"/docs/NativeApp/19.2.IOSAPP/fastlane\u81ea\u52a8\u5316IOS\u5de5\u7a0b-githubAction\u81ea\u52a8\u53d1\u5e03"}},f={},u=[{value:"1 \u4ec0\u4e48\u662f\u81ea\u52a8\u53d1\u5e03?",id:"1-\u4ec0\u4e48\u662f\u81ea\u52a8\u53d1\u5e03",level:2},{value:"2 \u5982\u4f55\u624d\u907f\u514d<strong>2-factor authentication (2FA)</strong>\u9a8c\u8bc1\u5462?",id:"2-\u5982\u4f55\u624d\u907f\u514d2-factor-authentication-2fa\u9a8c\u8bc1\u5462",level:2},{value:"3 \u83b7\u53d6App Store Connect API\u5bc6\u94a5\u548c\u76f8\u5173\u4fe1\u606f",id:"3-\u83b7\u53d6app-store-connect-api\u5bc6\u94a5\u548c\u76f8\u5173\u4fe1\u606f",level:2},{value:"4 \u4fee\u6539\u76f8\u5173\u914d\u7f6e",id:"4-\u4fee\u6539\u76f8\u5173\u914d\u7f6e",level:2},{value:"4.1 \u521b\u5efa<strong>fastlane/.env</strong>",id:"41-\u521b\u5efafastlaneenv",level:3},{value:"4.2 \u4fee\u6539<strong>fastlane/Fastfile</strong>",id:"42-\u4fee\u6539fastlanefastfile",level:3},{value:"5 \u5220\u9664\u672c\u5730\u8bc1\u4e66\u5e76\u6267\u884c<strong>bata</strong>\u6d41\u7a0b\u770b\u770b\u884c\u4e0d\u884c",id:"5-\u5220\u9664\u672c\u5730\u8bc1\u4e66\u5e76\u6267\u884cbata\u6d41\u7a0b\u770b\u770b\u884c\u4e0d\u884c",level:2},{value:"5.1 \u5982\u4f55\u5220\u9664\u672c\u5730\u8bc1\u4e66?",id:"51-\u5982\u4f55\u5220\u9664\u672c\u5730\u8bc1\u4e66",level:3},{value:"5.1 \u6267\u884c<strong>beta</strong>\u6d41\u7a0b",id:"51-\u6267\u884cbeta\u6d41\u7a0b",level:3},{value:"6 \u672c\u6b21\u6539\u52a8\u7684\u4ee3\u7801",id:"6-\u672c\u6b21\u6539\u52a8\u7684\u4ee3\u7801",level:2},{value:"7 \u603b\u7ed3",id:"7-\u603b\u7ed3",level:2},{value:"8 \u6e90\u4ee3\u7801",id:"8-\u6e90\u4ee3\u7801",level:2},{value:"8 \u53c2\u8003\u8d44\u6599",id:"8-\u53c2\u8003\u8d44\u6599",level:2}],d={toc:u};function m(e){var t=e.components,n=(0,i.Z)(e,s);return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"1-\u4ec0\u4e48\u662f\u81ea\u52a8\u53d1\u5e03"},"1 \u4ec0\u4e48\u662f\u81ea\u52a8\u53d1\u5e03?"),(0,o.kt)("p",null,"\u2003"," \u524d\u9762\u7684\u7ae0\u8282\u4e2d\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"beta"),"\u6d41\u7a0b\u5c3d\u7ba1\u80fd\u6267\u884c\uff0c\u4f46\u662f\uff0c\u5728\u540c\u6b65\u8bc1\u4e66\u7684\u8fc7\u7a0b\u4e2d\u8981\u6c42\u5f00\u53d1\u90fd\u8f93\u5165\u9a8c\u8bc1\u7801\u540e\u624d\u80fd\u8fdb\u884c\u53d1\u5e03\u3002\u8fd9\u6837\u4e00\u6765\u5c31\u7b97\u4e0d\u4e0a\u662f\u5168\u81ea\u52a8\u5316\u4e86\u3002\u6240\u4ee5\u672c\u7ae0\u8282\u5c31\n\u7684\u5185\u5bb9\u5c31\u662f\u6765\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0c\u8df3\u8fc7\u5f00\u53d1\u82f9\u679c\u7684",(0,o.kt)("a",{parentName:"p",href:"https://support.apple.com/en-us/HT204915"},"2-factor authentication (2FA)"),", \u5b9e\u73b0\u5b8c\u5168\u81ea\u52a8\u5316\u3002"),(0,o.kt)(l.Z,{src:"https://qiniu.wuchuheng.com/images/WX20230107-082950.png",align:"center",mdxType:"Img"}),(0,o.kt)("h2",{id:"2-\u5982\u4f55\u624d\u907f\u514d2-factor-authentication-2fa\u9a8c\u8bc1\u5462"},"2 \u5982\u4f55\u624d\u907f\u514d",(0,o.kt)("strong",{parentName:"h2"},"2-factor authentication (2FA)"),"\u9a8c\u8bc1\u5462?"),(0,o.kt)("p",null,"\u82f9\u679c\u5f00\u53d1\u5e73\u53f0\u4e0a\u6709",(0,o.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/appstoreconnectapi"},"App Store Connect API"),"\u8fd9\u79cd\u5bf9\u5916\u5f00\u653e\u7684api\uff0c\u53ef\u4ee5\u901a\u8fc7\n\u501f\u7740\u5f00\u53d1",(0,o.kt)("strong",{parentName:"p"},"api"),"\u6765\u907f\u514d\u8fd9\u79cd\u95ee\u9898\u3002\u6240\u4ee5\u4e3a\u4e86\u8c03\u7528\u8fd9\u4e2a",(0,o.kt)("strong",{parentName:"p"},"API`\uff0c \u6211\u4eec\u9700\u8981\u5728\u5f00\u53d1\u8005\u5e73\u53f0\u4e0a\u751f\u6210\u4e00\u4e2a\u5bc6\u94a5\uff0c\u624d\u80fd\u901a\u8fc7\u8fd9\u4e2a\u5bc6\u94a5\u6765\u8c03\u7528\u8fd9\u4e2a"),"API**."),(0,o.kt)("h2",{id:"3-\u83b7\u53d6app-store-connect-api\u5bc6\u94a5\u548c\u76f8\u5173\u4fe1\u606f"},"3 \u83b7\u53d6App Store Connect API\u5bc6\u94a5\u548c\u76f8\u5173\u4fe1\u606f"),(0,o.kt)("p",null,"\u5728",(0,o.kt)("a",{parentName:"p",href:"https://appstoreconnect.apple.com/access/api"},"App Store Connect API"),"\uff0c \u8fdb\u884c\u751f\u6210. \u7136\u540e\u628a\u6587\u4ef6\u4e0b\u8f7d\u4e0b\u6765\u3002"),(0,o.kt)(l.Z,{src:"https://qiniu.wuchuheng.com/images/WX20230107-130328.png",align:"center",mdxType:"Img"}),(0,o.kt)("h2",{id:"4-\u4fee\u6539\u76f8\u5173\u914d\u7f6e"},"4 \u4fee\u6539\u76f8\u5173\u914d\u7f6e"),(0,o.kt)("h3",{id:"41-\u521b\u5efafastlaneenv"},"4.1 \u521b\u5efa",(0,o.kt)("strong",{parentName:"h3"},"fastlane/.env")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},".env"),"\u6587\u4ef6\u662f\u7528\u4e8e\u4fdd\u5b58\u4e00\u4e9b\u5728",(0,o.kt)("inlineCode",{parentName:"p"},"fastlane"),"\u542f\u52a8\u65f6\u5c31\u9ed8\u8ba4\u52a0\u8f7d\u7684\u73af\u5883\u53d8\u91cf\u3002\u7531\u4e8e\u5bc6\u94a5\u7b49\u914d\u7f6e\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u4e0d\u80fd\u88ab\u6cc4\u6f0f\uff0c\u6240\u4ee5\u91c7\u7528",(0,o.kt)("inlineCode",{parentName:"p"},".env"),"\u6587\u4ef6\u5f62\u5f0f\u6765\u4fdd\u5b58\u8fd9\u4e9b\u4fe1\u606f\uff0c\n\u4e14\u4f1a\u88ab",(0,o.kt)("inlineCode",{parentName:"p"},"git"),"\u6240\u5ffd\u7565,\u6765\u4fdd\u8bc1\u5b89\u5168\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="fastlane/.env"',title:'"fastlane/.env"'},'# app store connect api key. https://appstoreconnect.apple.com/access/api\nAPP_STORE_CONNECT_API_KEY_CONTENT="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----"\n\n# Identifies the issuer who created the authentication token. https://appstoreconnect.apple.com/access/api\nAPP_STORE_CONNECT_API_ISSUER_ID="..."\n\n# The key of app store connect api. https://appstoreconnect.apple.com/access/api\nAPP_STORE_CONNECT_API_KEY_ID="..."\n')),(0,o.kt)("h3",{id:"42-\u4fee\u6539fastlanefastfile"},"4.2 \u4fee\u6539",(0,o.kt)("strong",{parentName:"h3"},"fastlane/Fastfile")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-git",metastring:'title="fastlane/fastfile"',title:'"fastlane/fastfile"'},'diff --git a/fastlane/Fastfile b/fastlane/Fastfile\nindex ab44af6..a9e5aab 100644\n--- a/fastlane/Fastfile\n+++ b/fastlane/Fastfile\n@@ -15,11 +15,17 @@\n \n default_platform(:ios)\n \n+# Load the App Store Connect API token to use in other fastlane tools and actions. https://docs.fastlane.tools/actions/app_store_connect_api_key/\n+api_key = app_store_connect_api_key(\n+    key_id: ENV["APP_STORE_CONNECT_API_KEY_ID"],\n+    issuer_id: ENV["APP_STORE_CONNECT_API_ISSUER_ID"],\n+    key_content: ENV["APP_STORE_CONNECT_API_KEY_CONTENT"]\n+)\n \n desc "Download certificates from the git"\n lane :syncCertificates do\n-    match(type: "appstore")\n-    match(type: "development")\n+    match(api_key: api_key, type: "appstore", readonly: true)\n+    match(api_key: api_key, type: "development", readonly: true)\n end\n \n platform :ios do\n..\n\n')),(0,o.kt)("h2",{id:"5-\u5220\u9664\u672c\u5730\u8bc1\u4e66\u5e76\u6267\u884cbata\u6d41\u7a0b\u770b\u770b\u884c\u4e0d\u884c"},"5 \u5220\u9664\u672c\u5730\u8bc1\u4e66\u5e76\u6267\u884c",(0,o.kt)("strong",{parentName:"h2"},"bata"),"\u6d41\u7a0b\u770b\u770b\u884c\u4e0d\u884c"),(0,o.kt)("h3",{id:"51-\u5982\u4f55\u5220\u9664\u672c\u5730\u8bc1\u4e66"},"5.1 \u5982\u4f55\u5220\u9664\u672c\u5730\u8bc1\u4e66?"),(0,o.kt)(l.Z,{src:"https://qiniu.wuchuheng.com/images/WX20230107-134713.png",align:"center",mdxType:"Img"}),(0,o.kt)("h3",{id:"51-\u6267\u884cbeta\u6d41\u7a0b"},"5.1 \u6267\u884c",(0,o.kt)("strong",{parentName:"h3"},"beta"),"\u6d41\u7a0b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ fastlane syncCertificates # \u540c\u6b65\u4e0b\u8bc1\u4e66\n$ fastlane beta # \u6267\u884c\u6d41\u7a0b\n[\u2714] \ud83d\ude80 \n[13:29:08]: fastlane detected a Gemfile in the current directory\n[13:29:08]: However, it seems like you didn't use `bundle exec`\n[13:29:08]: To launch fastlane faster, please use\n[13:29:08]: \n[13:29:08]: $ bundle exec fastlane beta\n[13:29:08]: \n...\n[13:32:00]: fastlane.tools finished successfully \ud83c\udf89\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u7ed3\u679c\u662f\u6210\u529f\u7684\uff0c\u4e5f\u6ca1\u6709\u51fa\u73b0\u89812\u6b21\u9a8c\u8bc1\u7684\u60c5\u51b5")),(0,o.kt)("h2",{id:"6-\u672c\u6b21\u6539\u52a8\u7684\u4ee3\u7801"},"6 \u672c\u6b21\u6539\u52a8\u7684\u4ee3\u7801"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-git",metastring:'title="\u672c\u6b21\u4fee\u6539\u7684\u6587\u4ef6"',title:'"\u672c\u6b21\u4fee\u6539\u7684\u6587\u4ef6"'},'diff --git a/.gitignore b/.gitignore\nindex 55a0685..10ed8c5 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -1,2 +1,5 @@\n *.zip\n *.ipa\n+.idea\n+fastlane/.env\n+tmp\ndiff --git a/fastlane/Fastfile b/fastlane/Fastfile\nindex ab44af6..a9e5aab 100644\n--- a/fastlane/Fastfile\n+++ b/fastlane/Fastfile\n@@ -15,11 +15,17 @@\n \n default_platform(:ios)\n \n+# Load the App Store Connect API token to use in other fastlane tools and actions. https://docs.fastlane.tools/actions/app_store_connect_api_key/\n+api_key = app_store_connect_api_key(\n+    key_id: ENV["APP_STORE_CONNECT_API_KEY_ID"],\n+    issuer_id: ENV["APP_STORE_CONNECT_API_ISSUER_ID"],\n+    key_content: ENV["APP_STORE_CONNECT_API_KEY_CONTENT"]\n+)\n \n desc "Download certificates from the git"\n lane :syncCertificates do\n-    match(type: "appstore")\n-    match(type: "development")\n+    match(api_key: api_key, type: "appstore", readonly: true)\n+    match(api_key: api_key, type: "development", readonly: true)\n end\n \n platform :ios do\ndiff --git a/fastlane/Matchfile b/fastlane/Matchfile\nindex c454c5d..05986fc 100644\n--- a/fastlane/Matchfile\n+++ b/fastlane/Matchfile\n@@ -4,8 +4,8 @@ storage_mode("git")\n \n type("development") # The default type, can be: appstore, adhoc, enterprise or development\n \n-# app_identifier(["tools.fastlane.app", "tools.fastlane.app2"])\n-# username("user@fastlane.tools") # Your Apple Developer Portal username\n+app_identifier(["com.wuchuheng"])\n+username("root@wuchuheng.com") # Your Apple Developer Portal username\n \n # For all available options run `fastlane match --help`\n # Remove the # in the beginning of the line to enable the other options\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ git add -A   \n$ git status \nOn branch master\nChanges to be committed:\n  (use \"git restore --staged <file>...\" to unstage)\n        modified:   .gitignore\n        new file:   fastlane/.env.example\n        modified:   fastlane/Fastfile\n        modified:   fastlane/Matchfile\n        modified:   fastlane/report.xml\n        modified:   wuchuheng.xcodeproj/project.pbxproj\n\n$ git commit -m 'feat: configure app-store-connect-api'\n[master f6c0f8a] feat: configure app-store-connect-api\n 6 files changed, 40 insertions(+), 13 deletions(-)\n create mode 100644 fastlane/.env.example\n")),(0,o.kt)("h2",{id:"7-\u603b\u7ed3"},"7 \u603b\u7ed3"),(0,o.kt)("p",null,"\u672c\u6587\u7684\u76ee\u6807\u662f\u89e3\u51b3\u4e4b\u524d\u5728\u540c\u6b65\u8bc1\u4e66\u65f6\u9047\u5230\u76842\u6b21\u9a8c\u8bc1\u6240\u5bfc\u81f4\u7684\u4e0d\u80fd\u5168\u81ea\u52a8\u5316\u5b9e\u73b0\u6d41\u7a0b\u3002\u4e3a\u6b64\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u901a\u8fc7\u4e86",(0,o.kt)("strong",{parentName:"p"},"app store connect api"),"\u7684\u5bf9\u5916\n\u63a5\u53e3\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n","\u2003"," \u90a3\u4e48\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\u540e\uff0c\u5c06\u5bf9\u540e\u9762\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"CI/CD"),"\u7684\u81ea\u52a8\u5316\u8d77\u5230\u4e86\u94fa\u5e73\u9053\u8def\u7684\u4f5c\u7528\u3002 "),(0,o.kt)("h2",{id:"8-\u6e90\u4ee3\u7801"},"8 \u6e90\u4ee3\u7801"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/wuchuheng/com.wuchuheng.ios.helloWorld"},"Source")),(0,o.kt)("h2",{id:"8-\u53c2\u8003\u8d44\u6599"},"8 \u53c2\u8003\u8d44\u6599"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.fastlane.tools/actions/app_store_connect_api_key/"},"\u300afastlane.app_store_connect_api_key\u300b")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://jaysavsani07.medium.com/flutter-ci-cd-with-github-actions-fastlane-part-2-ios-a4b281921d39"},"Flutter CI/CD with Github Actions & Fastlane - Part 2(IOS)"))))}m.isMDXComponent=!0}}]);