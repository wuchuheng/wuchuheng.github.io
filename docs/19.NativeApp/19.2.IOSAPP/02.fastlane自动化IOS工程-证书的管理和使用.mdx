---
title: 02 fastlaneè‡ªåŠ¨åŒ–IOSå·¥ç¨‹(äºŒ)-è¯ä¹¦çš„ç®¡ç†å’Œä½¿ç”¨
date: 2023-01-06 08:52
---

```mdx-code-block
import Img from '@site/src/components/Img/index';

```

## 1 ä¸ºä»€ä¹ˆè¦ç®¡ç†`certificates`å’Œ`profiles`?

&emsp;åœ¨å›¢é˜Ÿå¼€å‘æˆ–æ˜¯å…¶å®ƒçš„æƒ…å†µè€Œå¯¼è‡´ä¸€ä¸ªé¡¹ç›®æœ‰å¤šå°æœºå™¨åœ¨å¼€å‘æ—¶ã€‚è¿™æ—¶å°±éœ€è¦æŠŠåŒæ ·çš„`certificates`å’Œ`profile`æ‰‹åŠ¨æ›´æ–°åˆ°ä¸åŒçš„æœºå™¨ä¸Šã€‚è¿™æ ·æ‰æœ‰æƒé™å¯¹
é¡¹ç›®è¿›è¡Œå¼€å‘ä¸å‘å¸ƒã€‚è€Œé¡¹ç›®çš„`profile`æˆ–`certificates`çš„å˜åŠ¨ä¹Ÿä¼šå¯¼è‡´ä»¥ä¸Šçš„æ“ä½œå†æ¥ä¸€æ¬¡ã€‚è¿™æ ·çš„æ“ä½œè¿‡äºé‡å¤ä¸æ¯ç‡¥,æµªè´¹å¤§é‡ä¸å¿…è¦çš„æ—¶é—´ã€‚æ‰€ä»¥éœ€è¦
æœ‰ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼æ¥ç®¡ç†è¿™äº›`certificates`æˆ–`profiles`çš„å˜åŠ¨ï¼Œç„¶ååˆèƒ½ç»Ÿä¸€åœ°åŒæ­¥åˆ°æ‰€ä»¥æœºå™¨ä¸Šï¼Œè€Œä¸å½±å“å…¶å®ƒæœºå™¨çš„é¡¹ç›®å¼€å‘ã€‚è€Œåœ¨`fastlane`ä¸­ï¼Œè¿™
ç§æ–¹æ³•å·`match`ã€‚å®ƒæ˜¯é€šè¿‡æŠŠ`certificates`å’Œ`profiles`æ”¶é›†èµ·æ¥åœ¨åŒä¸€ä¸ªåœ°æ–¹ï¼Œå¦‚: `git`ç­‰ç­‰æ–¹å¼ï¼Œç„¶åä¸åŒçš„æœºå™¨å°±é€šè¿‡è¿™ç§æ–¹æ³•æ¥å®ç°æœ¬åœ°çš„`certificates`
æˆ–`profiles`çš„å˜æ›´åŒæ­¥ã€‚ 

<Img src='https://qiniu.wuchuheng.com/images/cs-git-img.png' align='center' />


## 2 å‡†å¤‡å·¥ä½œ

### 2.1 èƒ½åŸºæœ¬ä½¿ç”¨`fastlane`
&emsp;å¯¹`fastlane`æœ‰ä¸ªåŸºæœ¬çš„ä½¿ç”¨è®¤è¯†ã€‚å¦‚æœä¸æ˜¯æ–°æ‰‹ï¼Œä¹Ÿå¯èƒ½å‚è€ƒ[ã€Š01 fastlaneè‡ªåŠ¨åŒ–IOSå·¥ç¨‹(ä¸€)-æœ¬åœ°å…¥é—¨ä½¿ç”¨ç¯‡ã€‹](/docs/19.NativeApp/19.2.IOSAPP/01.fastlaneè‡ªåŠ¨åŒ–IOSå·¥ç¨‹-æœ¬åœ°å…¥é—¨ä½¿ç”¨ç¯‡.mdx)ã€‚ 
æœ¬æ–‡çš„é¡¹ç›®æ­£æ˜¯åŸºäº[ã€Š01 fastlaneè‡ªåŠ¨åŒ–IOSå·¥ç¨‹(ä¸€)-æœ¬åœ°å…¥é—¨ä½¿ç”¨ç¯‡ã€‹](/docs/19.NativeApp/19.2.IOSAPP/01.fastlaneè‡ªåŠ¨åŒ–IOSå·¥ç¨‹-æœ¬åœ°å…¥é—¨ä½¿ç”¨ç¯‡.mdx)
è€Œæ¥çš„ã€‚

### 2.2 åˆ›å»ºä¸€ä¸ªç§äºº`git`ä»“åº“ç”¨æ¥ä¿å­˜`profiles`å’Œ`certificates`
&emsp; æœ¬æ–‡ä¸¾ä¾‹ç”¨çš„æ˜¯git@github.com:wuchuheng/certificates.git çš„ç§äººä»“åº“æ¥ä¿å­˜è¿™äº›æ–‡ä»¶ã€‚


## 3 åˆå§‹åŒ–match

```bash  title="é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ"

$  fastlane match init

[âœ”] ğŸš€
[11:04:56]: fastlane match supports multiple storage modes, please select the one you want to use:
1. git
2. google_cloud
3. s3
4. gitlab_secure_files
?  1    #<-- è¿™é‡Œé€‰æ‹©1, ä¹Ÿå°±æ˜¯git
[11:05:21]: Please create a new, private git repository to store the certificates and profiles there
[11:05:21]: URL of the Git Repo: git@github.com:wuchuheng/certificates.git  #<-- å¡«å†™ä¸Šç”¨äºä¿å­˜çš„gitä»“åº“
[11:05:31]: Successfully created './Matchfile'. You can open the file using a code editor.
[11:05:31]: You can now run `fastlane match development`, `fastlane match adhoc`, `fastlane match enterprise` and `fastlane match appstore`
[11:05:31]: On the first run for each environment it will create the provisioning profiles and
[11:05:31]: certificates for you. From then on, it will automatically import the existing profiles.
[11:05:31]: For more information visit https://docs.fastlane.tools/actions/match/

```

> ç„¶åä¼šç”Ÿæˆ`fastlane/Matchfile`.

``` bash title="fastlane/Matchfile"
cat Matchfile

git_url("git@github.com:wuchuheng/certificates.git")

storage_mode("git")

type("development") # The default type, can be: appstore, adhoc, enterprise or development

# app_identifier(["tools.fastlane.app", "tools.fastlane.app2"])
# username("user@fastlane.tools") # Your Apple Developer Portal username

# For all available options run `fastlane match --help`
# Remove the # in the beginning of the line to enable the other options

# The docs are available on https://docs.fastlane.tools/actions/match
```

## 4 åŒæ­¥developmentå’Œapp storeçš„certificateså’Œprofiles

```bash title="é…ç½®developmentç›¸å…³çš„profileå’Œcertificates"
$ fastlane match development

[âœ”] ğŸš€
[11:13:37]: fastlane detected a Gemfile in the current directory
[11:13:37]: However, it seems like you didn't use `bundle exec`
[11:13:37]: To launch fastlane faster, please use
[11:13:37]:
[11:13:37]: $ bundle exec fastlane match development
[11:13:37]:
[11:13:37]: Get started using a Gemfile for fastlane https://docs.fastlane.tools/getting-started/ios/setup/#use-a-gemfile
[11:13:38]: Successfully loaded '/Users/wuchuheng/Desktop/myprojects/wuchuheng/ios/wuchuheng/fastlane/Matchfile' ğŸ“„

```

```bash title="é…ç½®appstoreç›¸å…³çš„profileå’Œcertificates"
fastlane match appstore

[âœ”] ğŸš€
[12:02:13]: fastlane detected a Gemfile in the current directory
[12:02:13]: However, it seems like you didn't use `bundle exec`
[12:02:13]: To launch fastlane faster, please use
[12:02:13]:
[12:02:13]: $ bundle exec fastlane match appstore
[12:02:13]:
[12:02:13]: Get started using a Gemfile for fastlane https://docs.fastlane.tools/getting-started/ios/setup/#use-a-gemfile
[12:02:15]: Successfully loaded '/Users/wuchuheng/Desktop/myprojects/wuchuheng/ios/wuchuheng/fastlane/Matchfile' ğŸ“„

```

> ç„¶åæ‰§è¡Œè¿‡åï¼Œä¼šåœ¨å¼€å‘éƒ½å¹³å°ä¸Šç”Ÿæˆä»¥`match`ä¸ºå‰ç¼€çš„å¯¹åº”çš„`profiles`

<Img src="https://qiniu.wuchuheng.com/images/WX20230106-121756.png" align={'center'} />


> å†ç„¶åï¼Œä¹Ÿä¼šæŠŠå¯¹åº”çš„`certificates`å’Œ`profiles`ä¸Šä¼ åˆ°gitä¸Š

<Img src="https://qiniu.wuchuheng.com/images/WX20230106-120833.png" align={'center'} />

## 5 æµ‹è¯•æœ¬åœ°çš„matchèƒ½å¦ä½¿ç”¨æ­£å¸¸

### 5.1 åœ¨xcodeä¸­ä½¿ç”¨å·²ç»ç”Ÿæˆçš„`profiles`
åœ¨xcodeä¸­æ‰“å¼€é¡¹ç›®ï¼Œç„¶å: 

<Img src="https://qiniu.wuchuheng.com/images/WX20230106-122606.png" align="center" />

### 5.2 å»é™¤fastlane/Fastfileä¸­çš„ä¸‹è½½certificateså’Œprofilesæ­¥éª¤
```git
diff --git a/fastlane/Fastfile b/fastlane/Fastfile
index b2f1b3c..6bbddb7 100644
--- a/fastlane/Fastfile
+++ b/fastlane/Fastfile
@@ -18,8 +18,8 @@ default_platform(:ios)
 platform :ios do
   desc "Push a new beta build to TestFlight"
   lane :beta do
-    get_certificates           # invokes cert
-    get_provisioning_profile
     increment_build_number(xcodeproj: "wuchuheng.xcodeproj")
     build_app(scheme: "wuchuheng")
     upload_to_testflight

```

### 5.3 æœ¬åœ°æ‰§è¡Œfastlaneæµç¨‹

```bash
$ fastlane beta
fastlane beta

[âœ”] ğŸš€
[12:30:31]: fastlane detected a Gemfile in the current directory
[12:30:31]: However, it seems like you didn't use `bundle exec`
[12:30:31]: To launch fastlane faster, please use
[12:30:31]:
[12:30:31]: $ bundle exec fastlane beta
[12:30:31]:
[12:30:31]: Get started using a Gemfile for fastlane https://docs.fastlane.tools/getting-started/ios/setup/#use-a-gemfile
[12:30:32]: ------------------------------
[12:30:32]: --- Step: default_platform ---
[12:30:32]: ------------------------------
[12:30:32]: Driving the lane 'ios beta' ğŸš€
[12:30:32]: ------------------------------------
[12:30:32]: --- Step: increment_build_number ---
[12:30:32]: ------------------------------------
Current version of project wuchuheng is: 19
...
 +------+------------------------+-------------+
|              fastlane summary               |
+------+------------------------+-------------+
| Step | Action                 | Time (in s) |
+------+------------------------+-------------+
| 1    | default_platform       | 0           |
| 2    | increment_build_number | 1           |
| 3    | build_app              | 15          |
| 4    | upload_to_testflight   | 218         |
+------+------------------------+-------------+

[12:34:27]: fastlane.tools finished successfully ğŸ‰
```
:::tip æç¤º
åœ¨å‘å¸ƒçš„è¿‡ç¨‹ä¸­ä¼šè¦æ±‚ä¸€ä¸ªæŒ‡å®šå¯†ç : FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD, è¿™ä¸ªå¯†ç éœ€è¦åˆ°[appleid.apple.com](https://appleid.apple.com/account/manage)
è¿›è¡Œç”Ÿæˆ
:::

> ç»“æœæµç¨‹æ˜¯èƒ½è·‘é€šçš„ã€‚


### 5.4 æäº¤ä»£ç 
> æœ¬æ¬¡æ“ä½œè¦æäº¤çš„ä»£ç 

```git
diff --git a/fastlane/Fastfile b/fastlane/Fastfile
index b2f1b3c..e9c9a09 100644
--- a/fastlane/Fastfile
+++ b/fastlane/Fastfile
@@ -18,8 +18,6 @@ default_platform(:ios)
+
+desc "Download certificates from the git"
+lane :syncCertificates do
+    match(type: "appstore")
+    match(type: "development")
+end
+
 platform :ios do
   desc "Push a new beta build to TestFlight"
   lane :beta do
-    get_certificates           # invokes cert
-    get_provisioning_profile
     increment_build_number(xcodeproj: "wuchuheng.xcodeproj")
     build_app(scheme: "wuchuheng")
     upload_to_testflight
diff --git a/fastlane/report.xml b/fastlane/report.xml
index f1fb1ac..0fc18d8 100644

diff --git a/wuchuheng.xcodeproj/project.pbxproj b/wuchuheng.xcodeproj/project.pbxproj
index 79a2ba3..a82bb04 100644
--- a/wuchuheng.xcodeproj/project.pbxproj
+++ b/wuchuheng.xcodeproj/project.pbxproj
@@ -417,7 +417,7 @@
 				ASSETCATALOG_COMPILER_INCLUDE_ALL_APPICON_ASSETS = NO;
 				CODE_SIGN_IDENTITY = "iPhone Developer";
 				CODE_SIGN_STYLE = Manual;
-				CURRENT_PROJECT_VERSION = 17;
+				CURRENT_PROJECT_VERSION = 20;
 				DEVELOPMENT_ASSET_PATHS = "\"wuchuheng/Preview Content\"";
 				DEVELOPMENT_TEAM = 5D6L6979M7;
 				ENABLE_PREVIEWS = YES;
@@ -434,7 +434,7 @@
 				MARKETING_VERSION = 1.0;
 				PRODUCT_BUNDLE_IDENTIFIER = com.wuchuheng;
 				PRODUCT_NAME = "$(TARGET_NAME)";
-				PROVISIONING_PROFILE_SPECIFIER = com.wuchuheng_airDeveloper;
+				PROVISIONING_PROFILE_SPECIFIER = "match Development com.wuchuheng 1672977205";
 				SWIFT_EMIT_LOC_STRINGS = YES;
 				SWIFT_VERSION = 5.0;
 				TARGETED_DEVICE_FAMILY = "1,2";
@@ -449,7 +449,7 @@
 				ASSETCATALOG_COMPILER_INCLUDE_ALL_APPICON_ASSETS = NO;
 				CODE_SIGN_IDENTITY = "iPhone Distribution";
 				CODE_SIGN_STYLE = Manual;
-				CURRENT_PROJECT_VERSION = 17;
+				CURRENT_PROJECT_VERSION = 20;
 				DEVELOPMENT_ASSET_PATHS = "\"wuchuheng/Preview Content\"";
 				DEVELOPMENT_TEAM = 5D6L6979M7;
 				ENABLE_PREVIEWS = YES;
@@ -466,7 +466,7 @@
 				MARKETING_VERSION = 1.0;
 				PRODUCT_BUNDLE_IDENTIFIER = com.wuchuheng;
 				PRODUCT_NAME = "$(TARGET_NAME)";
-				PROVISIONING_PROFILE_SPECIFIER = com.wuchuheng_airRelease;
+				PROVISIONING_PROFILE_SPECIFIER = "match AppStore com.wuchuheng";
 				SWIFT_EMIT_LOC_STRINGS = YES;
 				SWIFT_VERSION = 5.0;
 				TARGETED_DEVICE_FAMILY = "1,2";
@@ -479,7 +479,7 @@
 				ALWAYS_EMBED_SWIFT_STANDARD_LIBRARIES = YES;
 				BUNDLE_LOADER = "$(TEST_HOST)";
 				CODE_SIGN_STYLE = Automatic;
-				CURRENT_PROJECT_VERSION = 17;
+				CURRENT_PROJECT_VERSION = 20;
 				DEVELOPMENT_TEAM = 5D6L6979M7;
 				GENERATE_INFOPLIST_FILE = YES;
 				IPHONEOS_DEPLOYMENT_TARGET = 15.5;
@@ -499,7 +499,7 @@
 				ALWAYS_EMBED_SWIFT_STANDARD_LIBRARIES = YES;
 				BUNDLE_LOADER = "$(TEST_HOST)";
 				CODE_SIGN_STYLE = Automatic;
-				CURRENT_PROJECT_VERSION = 17;
+				CURRENT_PROJECT_VERSION = 20;
 				DEVELOPMENT_TEAM = 5D6L6979M7;
 				GENERATE_INFOPLIST_FILE = YES;
 				IPHONEOS_DEPLOYMENT_TARGET = 15.5;
@@ -518,7 +518,7 @@
 			buildSettings = {
 				ALWAYS_EMBED_SWIFT_STANDARD_LIBRARIES = YES;
 				CODE_SIGN_STYLE = Automatic;
-				CURRENT_PROJECT_VERSION = 17;
+				CURRENT_PROJECT_VERSION = 20;
 				DEVELOPMENT_TEAM = 5D6L6979M7;
 				GENERATE_INFOPLIST_FILE = YES;
 				MARKETING_VERSION = 1.0;
@@ -536,7 +536,7 @@
 			buildSettings = {
 				ALWAYS_EMBED_SWIFT_STANDARD_LIBRARIES = YES;
 				CODE_SIGN_STYLE = Automatic;
-				CURRENT_PROJECT_VERSION = 17;
+				CURRENT_PROJECT_VERSION = 20;
 				DEVELOPMENT_TEAM = 5D6L6979M7;
 				GENERATE_INFOPLIST_FILE = YES;
 				MARKETING_VERSION = 1.0;
```

``` bash 
$ git add -A
$ git status

On branch main
Changes to be committed:
  (use "git restore --staged <file>..." to unstage)
	new file:   .gitignore
	modified:   fastlane/Fastfile
	new file:   fastlane/Matchfile
	modified:   fastlane/report.xml
	deleted:    wuchuheng.app.dSYM.zip
	modified:   wuchuheng.xcodeproj/project.pbxproj
$ git commit -m 'feat: init match'
$ git commit -m 'feat: init match'

[main 34d6016] feat: init match
 7 files changed, 181 insertions(+), 48 deletions(-)
 create mode 100644 .gitignore
 create mode 100644 fastlane/Matchfile
 rewrite fastlane/report.xml (60%)
 create mode 100644 tmp
 delete mode 100644 wuchuheng.app.dSYM.zip
```


## 6 åœ¨åˆ«çš„æœºå™¨é€šè¿‡matchè¿›è¡Œprofileså’Œcertificatesçš„å¯¼å…¥ä¸ä½¿ç”¨
``` bash
$ git clone git@github.com:wuchuheng/com.wuchuheng.ios.helloWorld.git # ä¸‹è½½é¡¹ç›®
$ cd com.wuchuheng.ios.helloWorld
$ fastlane syncCertificates # åŒæ­¥è¯ä¹¦æµç¨‹
$ fastlane beta # æ‰§è¡Œæ„å»ºå’Œå‘å¸ƒæµç¨‹
```
æ‰§è¡Œçš„ç»“æœä¹Ÿæ˜¯okçš„

## 7 æ–‡ä¸­æ¶‰åŠåˆ°çš„å˜é‡

* fastlane match password: è¿™æ˜¯fastlaneåœ¨åŒæ­¥`git`ä¸­çš„è¯ä¹¦(**certificates**)åˆ°æœ¬åœ°æˆ–çº¿ä¸Šæ—¶ï¼Œéœ€è¦ç”¨åˆ°çš„å¯†ç 
* specific password: è¿™æ˜¯`beta`æµç¨‹åœ¨å‘å¸ƒåº”ç”¨æ—¶ï¼Œéœ€è¦ç”¨åˆ°çš„å¯†ç ï¼Œåœ¨ [appleid.apple.com](https://appleid.apple.com/account/manage)è¿›è¡Œç”³è¯·ã€‚

## 8 æ€»ç»“
æœ¬æ–‡ä¸»è¦æ˜¯è§£å†³è¯ä¹¦çš„æ›´æ–°å’ŒåŒæ­¥çš„é—®é¢˜ï¼Œä»ä¸€å°ä¸»æœºä¸Šè¿›è¡Œ`app`çš„å¼€å‘ï¼Œç„¶åæŠŠè¯ä¹¦(**certificates**)å’Œç›¸å…³çš„é…ç½®(**profiles**)åŒæ­¥åˆ°**git**, 
è€Œå…¶å®ƒçš„å¼€å‘æœºå™¨å°±å¯ä»¥æ‰§è¡ŒåŒæ­¥è¯ä¹¦(**certificate**)çš„æµç¨‹æ¥å®ç°è¯ä¹¦çš„æ›´æ–°ã€‚ä»è€ŒèŠ‚çœå„ç§æ‰‹åŠ¨å¯¼å…¥é€ æˆçš„æ—¶é—´æµªè´¹ã€‚

## æœ¬æ–‡æºä»£ç 

[Source](https://github.com/wuchuheng/com.wuchuheng.ios.helloWorld)

## å‚è€ƒèµ„æ–™:

* [ã€ŠFastlaneçš„matchæ–‡æ¡£ã€‹](https://docs.fastlane.tools/actions/match/) 
* [ã€ŠCodesigningçš„æ¦‚å¿µè¯´æ˜ã€‹](https://codesigning.guide/) 
